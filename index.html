<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="代码,博客" />
       
      <meta name="description" content="my blog" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Welcome to jxx&#39;s blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Welcome to jxx&#39;s blog</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['你一定能够成为你想要去成为的人', 'Good luck everyday', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  
<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content">Welcome to jxx&#39;s blog</div>
</div>


<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Promise"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/03/03/Promise/"
    >Promise</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/03/03/Promise/" class="article-date">
  <time datetime="2022-03-03T06:11:53.000Z" itemprop="datePublished">2022-03-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">web前端学习笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <span id="more"></span>



<h1 id="第-1-章：Promise-的理解和使用"><a href="#第-1-章：Promise-的理解和使用" class="headerlink" title="第 1 章：Promise 的理解和使用"></a><strong>第</strong> <strong>1</strong> <strong>章：</strong>Promise <strong>的理解和使用</strong></h1><h2 id="1-1-Promise-是什么"><a href="#1-1-Promise-是什么" class="headerlink" title="1.1. Promise 是什么?"></a><strong>1.1. Promise</strong> <strong>是什么</strong>?</h2><h3 id="1-1-1-理解"><a href="#1-1-1-理解" class="headerlink" title="1.1.1. 理解"></a><strong>1.1.1.</strong> <strong>理解</strong></h3><ol>
<li><p>抽象表达: </p>
<ol>
<li><p>Promise 是一门新的技术(ES6 规范)</p>
</li>
<li><p>Promise 是 JS 中进行异步编程的新解决方案</p>
</li>
</ol>
<p>备注：旧方案是单纯使用回调函数</p>
</li>
<li><p>具体表达:</p>
<ol>
<li><p>从语法上来说: Promise 是一个构造函数</p>
</li>
<li><p>从功能上来说: promise 对象用来封装一个异步操作并可以获取其成功/失败的结果值</p>
</li>
</ol>
</li>
</ol>
<h3 id="1-1-2-promise-的状态改变"><a href="#1-1-2-promise-的状态改变" class="headerlink" title="1.1.2. promise 的状态改变"></a><strong>1.1.2. promise</strong> <strong>的状态改变</strong></h3><ol>
<li><p>pending 变为 resolved</p>
</li>
<li><p>pending 变为 rejected</p>
</li>
</ol>
<p>说明: 只有这 2 种, 且一个 promise 对象只能改变一次</p>
<p> 无论变为成功还是失败, 都会有一个结果数据</p>
<p> 成功的结果数据一般称为 value, 失败的结果数据一般称为 reason </p>
<h3 id="1-1-3-promise-的基本流程"><a href="#1-1-3-promise-的基本流程" class="headerlink" title="1.1.3. promise 的基本流程"></a><strong>1.1.3. promise</strong> <strong>的基本流程</strong></h3><p><img src="https://gitee.com/jin-xiaoxin/typora-img/raw/master/typora_images/image-20220304121039515.png" alt="image-20220304121039515"></p>
<h3 id="1-1-4-promise-的基本使用"><a href="#1-1-4-promise-的基本使用" class="headerlink" title="1.1.4. promise 的基本使用"></a><strong>1.1.4. promise</strong> <strong>的基本使用</strong></h3><ol>
<li>使用 1: 基本编码流程</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 1) 创建 promise 对象(pending 状态), 指定执行器函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2) 在执行器函数中启动异步任务</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> time = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 3) 根据结果做不同处理</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 3.1) 如果成功了, 调用 resolve(), 指定成功的 value, 变为 resolved 状 态</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (time % <span class="number">2</span> === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">resolve</span>(<span class="string">&#x27;成功的值 &#x27;</span> + time)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// 3.2) 如果失败了, 调用 reject(), 指定失败的 reason, 变为rejected 状态</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">reject</span>(<span class="string">&#x27;失败的值&#x27;</span> + time)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">2000</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用 2: 使用 promise 封装基于定时器的异步</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">doDelay</span>(<span class="params">time</span>) &#123; <span class="comment">// 1. 创建 promise 对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 2. 启动异步任务</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;启动异步任务&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;延迟任务开始执行...&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> time = <span class="title class_">Date</span>.<span class="title function_">now</span>() <span class="comment">// 假设: 时间为奇数代表成功, 为偶数代表失败</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (time % <span class="number">2</span> === <span class="number">1</span>) &#123; <span class="comment">// 成功了</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 3. 1. 如果成功了, 调用 resolve()并传入成功的 value</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">resolve</span>(<span class="string">&#x27;成功的数据 &#x27;</span> + time)</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 失败了</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 3.2. 如果失败了, 调用 reject()并传入失败的 reason</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">reject</span>(<span class="string">&#x27;失败的数据 &#x27;</span> + time)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;, time)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> promise = <span class="title function_">doDelay</span>(<span class="number">2000</span>)</span></span><br><span class="line"><span class="language-javascript">  promise.<span class="title function_">then</span>(</span></span><br><span class="line"><span class="language-javascript">    <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功的 value: &#x27;</span>, value)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;失败的 reason: &#x27;</span>, reason)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  )</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>使用 3: 使用 promise 封装 ajax 异步请求</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  可复用的发 ajax 请求的函数: xhr + promise</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">promiseAjax</span>(<span class="params">url</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="property">onreadystatechange</span> = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (xhr.<span class="property">readyState</span> !== <span class="number">4</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> &#123; status, response &#125; = xhr</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 请求成功, 调用 resolve(value)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(response))</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 请求失败, 调用 reject(reason)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;请求失败: status: &#x27;</span> + status))</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, url)</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">send</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">promiseAjax</span>(<span class="string">&#x27;https://api.apiopen.top2/getJoke?page=1&amp;count=2&amp;type=video&#x27;</span>).<span class="title function_">then</span>(</span></span><br><span class="line"><span class="language-javascript">    <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;显示成功数据&#x27;</span>, data)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">alert</span>(error.<span class="property">message</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-为什么要用-Promise"><a href="#1-2-为什么要用-Promise" class="headerlink" title="1.2. 为什么要用 Promise?"></a><strong>1.2.</strong> <strong>为什么要用</strong> <strong>Promise?</strong></h2><h3 id="1-2-1-指定回调函数的方式更加灵活"><a href="#1-2-1-指定回调函数的方式更加灵活" class="headerlink" title="1.2.1. 指定回调函数的方式更加灵活"></a><strong>1.2.1.</strong> <strong>指定回调函数的方式更加灵活</strong></h3><ol>
<li><p>旧的: 必须在启动异步任务前指定</p>
</li>
<li><p>promise: 启动异步任务 =&gt; 返回promie对象 =&gt; 给promise对象绑定回调函数(甚至可以在异步任务结束后指定/多个) </p>
</li>
</ol>
<h3 id="1-2-2-支持链式调用-可以解决回调地狱问题"><a href="#1-2-2-支持链式调用-可以解决回调地狱问题" class="headerlink" title="1.2.2. 支持链式调用,可以解决回调地狱问题"></a><strong>1.2.2.</strong> 支持链式调用,可以解决回调地狱问题</h3><ol>
<li><p>什么是回调地狱? </p>
<p>回调函数嵌套调用, 外部回调函数异步执行的结果是嵌套的回调执行的条件</p>
</li>
<li><p>回调地狱的缺点? </p>
<p>不便于阅读</p>
<p>不便于异常处理</p>
</li>
<li><p>解决方案?</p>
<p>promise 链式调用</p>
</li>
<li><p>终极解决方案?</p>
<p>async/await</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  1. 指定回调函数的方式更加灵活:</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  旧的: 必须在启动异步任务前指定</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  promise: 启动异步任务 =&gt; 返回 promie 对象 =&gt; 给 promise 对象绑定回调函数</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  (甚至可以在异步任务结束后指定)</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  2. 支持链式调用, 可以解决回调地狱问题</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  什么是回调地狱? 回调函数嵌套调用, 外部回调函数异步执行的结果是嵌套的回调函</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  数执行的条件</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  回调地狱的缺点? 不便于阅读 / 不便于异常处理</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  解决方案? promise 链式调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  终极解决方案? async/await</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 成功的回调函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">successCallback</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;声音文件创建成功: &quot;</span> + result);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 失败的回调函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">failureCallback</span>(<span class="params">error</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;声音文件创建失败: &quot;</span> + error);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/* 1.1 使用纯回调函数 */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createAudioFileAsync</span>(audioSettings, successCallback, failureCallback)</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/* 1.2. 使用 Promise */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> promise = <span class="title function_">createAudioFileAsync</span>(audioSettings); <span class="comment">// 2</span></span></span><br><span class="line"><span class="language-javascript">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    promise.<span class="title function_">then</span>(successCallback, failureCallback);</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="number">3000</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  2.1. 回调地狱</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">doSomething</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">doSomethingElse</span>(result, <span class="keyword">function</span> (<span class="params">newResult</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">doThirdThing</span>(newResult, <span class="keyword">function</span> (<span class="params">finalResult</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got the final result: &#x27;</span> + finalResult)</span></span><br><span class="line"><span class="language-javascript">      &#125;, failureCallback)</span></span><br><span class="line"><span class="language-javascript">    &#125;, failureCallback)</span></span><br><span class="line"><span class="language-javascript">  &#125;, failureCallback)</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  2.2. 使用 promise 的链式调用解决回调地狱</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">doSomething</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="title function_">doSomethingElse</span>(result)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">newResult</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="title function_">doThirdThing</span>(newResult)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">finalResult</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got the final result: &#x27;</span> + finalResult)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">catch</span>(failureCallback)</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  2.3. async/await: 回调地狱的终极解决方案</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">  */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">doSomething</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> newResult = <span class="keyword">await</span> <span class="title function_">doSomethingElse</span>(result)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> finalResult = <span class="keyword">await</span> <span class="title function_">doThirdThing</span>(newResult)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got the final result: &#x27;</span> + finalResult)</span></span><br><span class="line"><span class="language-javascript">    &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">failureCallback</span>(error)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="1-3-如何使用-Promise"><a href="#1-3-如何使用-Promise" class="headerlink" title="1.3. 如何使用 Promise?"></a><strong>1.3.</strong> <strong>如何使用</strong> <strong>Promise?</strong></h2><h3 id="1-3-1-API"><a href="#1-3-1-API" class="headerlink" title="1.3.1. API"></a><strong>1.3.1. API</strong></h3><ol>
<li><p>Promise 构造函数: <code>Promise (excutor) &#123;&#125;</code></p>
<p>(1) executor 函数: 执行器 <code>(resolve, reject) =&gt; &#123;&#125; </code></p>
<p>(2) resolve 函数: 内部定义成功时我们调用的函数 <code>value =&gt; &#123;&#125;</code></p>
<p>(3) reject 函数: 内部定义失败时我们调用的函数<code> reason =&gt; &#123;&#125;</code></p>
<p>说明: executor 会在 Promise 内部立即同步调用,异步操作在执行器中执行</p>
</li>
<li><p>Promise.prototype.then 方法: <code>(onResolved, onRejected) =&gt; &#123;&#125;</code></p>
<p>(1) onResolved 函数: 成功的回调函数 <code>(value) =&gt; &#123;&#125;</code></p>
<p>(2) onRejected 函数: 失败的回调函数 <code>(reason) =&gt; &#123;&#125;</code></p>
<p>说明: 指定用于得到成功 value 的成功回调和用于得到失败 reason 的失败回调</p>
<p>返回一个新的 promise 对象</p>
</li>
<li><p>Promise.prototype.catch 方法:<code> (onRejected) =&gt; &#123;&#125;</code></p>
<p>(1) onRejected 函数: 失败的回调函数<code>(reason) =&gt; &#123;&#125;</code></p>
<p> 说明: then()的语法糖, 相当于: then(undefined, onRejected)</p>
</li>
<li><p>Promise.resolve 方法: <code>(value) =&gt; &#123;&#125;</code></p>
<p>(1) value: 成功的数据或 promise 对象</p>
<p>说明: 返回一个成功/失败的 promise 对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">123</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">resolve</span>(<span class="string">&#x27;ok&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// reject(&#x27;error&#x27;)</span></span></span><br><span class="line"><span class="language-javascript">  &#125;))</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;p1----&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(p1);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;p2----&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(p2);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/jin-xiaoxin/typora-img/raw/master/typora_images/image-20220304132426355.png" alt="image-20220304132426355"></p>
</li>
<li><p>Promise.reject 方法:<code> (reason) =&gt; &#123;&#125;</code></p>
<p>(1) reason: 失败的原因</p>
<p>说明: 返回一个失败的 promise 对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p1=<span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="number">123</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p2=<span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">resolve</span>(<span class="string">&#x27;ok&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;))</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---p1---&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(p1);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---p2---&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(p2);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/jin-xiaoxin/typora-img/raw/master/typora_images/image-20220304141656016.png" alt="image-20220304141656016"></p>
</li>
<li><p>Promise.all 方法: <code>(promises) =&gt; &#123;&#125;</code></p>
<p>(1) promises: 包含 n 个 promise 的数组</p>
<p>说明: 返回一个新的 promise, 只有所有的 promise 都成功才成功, 只要有一个失败了就直接失败,并且返回的结果是失败的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">123</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">resolve</span>(<span class="string">&#x27;ok&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;))</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p3 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;error&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> result1 = <span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2, p3])</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> result2 = <span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2])</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---result1---&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---result2---&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result2);</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/jin-xiaoxin/typora-img/raw/master/typora_images/image-20220304143828094.png" alt="image-20220304143828094"></p>
<p>如果all里有多个失败的内容，则返回第一个失败的promise对象</p>
</li>
<li><p>Promise.race 方法:<code> (promises) =&gt; &#123;&#125;</code></p>
<p>(1) promises: 包含 n 个 promise 的数组</p>
<p>说明: 返回一个新的 promise, 第一个完成的 promise 的结果状态就是最终的结果状态</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">123</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">resolve</span>(<span class="string">&#x27;ok&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;))</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p3 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;error&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> p4 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() % <span class="number">2</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">resolve</span>(<span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">reject</span>(<span class="number">2</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> result1 = <span class="title class_">Promise</span>.<span class="title function_">race</span>([p4,p3, p1, p2])</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result1);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/jin-xiaoxin/typora-img/raw/master/typora_images/image-20220304145219198.png" alt="image-20220304145219198"></p>
</li>
</ol>
<h3 id="1-3-2-promise-的几个关键问题"><a href="#1-3-2-promise-的几个关键问题" class="headerlink" title="1.3.2. promise 的几个关键问题"></a><strong>1.3.2. promise</strong> <strong>的几个关键问题</strong></h3><h4 id="1-如何改变-promise-的状态"><a href="#1-如何改变-promise-的状态" class="headerlink" title="1. 如何改变 promise 的状态?"></a>1. 如何改变 promise 的状态?</h4><p>(1) resolve(value): 如果当前是 pending 就会变为 resolved</p>
<p>(2) reject(reason): 如果当前是 pending 就会变为 rejected</p>
<p>(3) 抛出异常: 如果当前是 pending 就会变为 rejected</p>
<h4 id="2-一个-promise-指定多个成功-失败回调函数-都会调用吗"><a href="#2-一个-promise-指定多个成功-失败回调函数-都会调用吗" class="headerlink" title="2. 一个 promise 指定多个成功/失败回调函数, 都会调用吗?"></a>2. 一个 promise 指定多个成功/失败回调函数, 都会调用吗?</h4><p>当 promise 改变为对应状态时都会调用</p>
<h4 id="3-改变-promise-状态和指定回调函数谁先谁后"><a href="#3-改变-promise-状态和指定回调函数谁先谁后" class="headerlink" title="3. 改变 promise 状态和指定回调函数谁先谁后?"></a>3. 改变 promise 状态和指定回调函数谁先谁后?</h4><p>(1) 都有可能, 正常情况下是先指定回调再改变状态, 但也可以先改状态再指定回调</p>
<p>(2) 如何先改状态再指定回调? </p>
<p>① 在执行器中直接调用 resolve()/reject()</p>
<p>② 延迟更长时间才调用 then()</p>
<p>(3) 什么时候才能得到数据? </p>
<p>① 如果先指定的回调, 那当状态发生改变时, 回调函数就会调用, 得到数据</p>
<p>②如果先改变的状态, 那当指定回调时, 回调函数就会调用, 得到数据</p>
<h4 id="4-promise-then-返回的新-promise-的结果状态由什么决定"><a href="#4-promise-then-返回的新-promise-的结果状态由什么决定" class="headerlink" title="4. promise.then()返回的新 promise 的结果状态由什么决定?"></a>4. promise.then()返回的新 promise 的结果状态由什么决定?</h4><p>(1) 简单表达: 由 then()指定的回调函数执行的结果决定</p>
<p>(2) 详细表达: </p>
<p>① 如果抛出异常, 新 promise 变为 rejected, reason 为抛出的异常</p>
<p>② 如果返回的是非 promise 的任意值, 新 promise 变为 resolved, value 为返回的值</p>
<p>③ 如果返回的是另一个新 promise, 此 promise 的结果就会成为新 promise 的结果</p>
<h4 id="5-promise-如何串连多个操作任务"><a href="#5-promise-如何串连多个操作任务" class="headerlink" title="5. promise 如何串连多个操作任务?"></a>5. promise 如何串连多个操作任务?</h4><p>(1) promise 的 then()返回一个新的 promise, 可以开成 then()的链式调用</p>
<p>(2) 通过 then 的链式调用串连多个同步/异步任务 </p>
<h4 id="6-promise-异常传透"><a href="#6-promise-异常传透" class="headerlink" title="6. promise 异常传透?"></a>6. promise 异常传透?</h4><p>(1) 当使用 promise 的 then 链式调用时, 可以在最后指定失败的回调, </p>
<p>(2) 前面任何操作出了异常, 都会传到最后失败的回调中处理</p>
<h4 id="7-中断-promise-链"><a href="#7-中断-promise-链" class="headerlink" title="7. 中断 promise 链?"></a>7. 中断 promise 链?</h4><p>(1) 当使用 promise 的 then 链式调用时, 在中间中断, 不再调用后面的回调函数</p>
<p>(2) 办法: 在回调函数中返回一个 pendding 状态的 promise 对象</p>
<h1 id="第-2-章：自定义-手写-Promise"><a href="#第-2-章：自定义-手写-Promise" class="headerlink" title="第 2 章：自定义(手写)Promise"></a><strong>第</strong> <strong>2</strong> <strong>章：自定义</strong>(手写)Promise</h1><h2 id="2-1-定义整体结构"><a href="#2-1-定义整体结构" class="headerlink" title="2.1. 定义整体结构"></a><strong>2.1.</strong> <strong>定义整体结构</strong></h2><h2 id="2-2-Promise-构造函数的实现"><a href="#2-2-Promise-构造函数的实现" class="headerlink" title="2.2. Promise 构造函数的实现"></a><strong>2.2. Promise</strong> <strong>构造函数的实现</strong></h2><h2 id="2-3-promise-then-catch-的实现"><a href="#2-3-promise-then-catch-的实现" class="headerlink" title="2.3. promise.then()/catch()的实现"></a>2.3. promise.then()/catch()的实现</h2><h2 id="2-4-Promise-resolve-reject-的实现"><a href="#2-4-Promise-resolve-reject-的实现" class="headerlink" title="**2.4. Promise.resolve()/reject()**的实现"></a>**2.4. Promise.resolve()/reject()**的实现</h2><h2 id="2-5-Promise-all-race-的实现"><a href="#2-5-Promise-all-race-的实现" class="headerlink" title="**2.5. Promise.all/race()**的实现"></a>**2.5. Promise.all/race()**的实现</h2><h2 id="2-6-Promise-resolveDelay-rejectDelay-的实现"><a href="#2-6-Promise-resolveDelay-rejectDelay-的实现" class="headerlink" title="**2.6. Promise.resolveDelay()/rejectDelay()**的实现"></a>**2.6. Promise.resolveDelay()/rejectDelay()**的实现</h2><h2 id="2-7-ES5-function完整版本"><a href="#2-7-ES5-function完整版本" class="headerlink" title="2.7. ES5 function完整版本"></a>2.7. ES5 function<strong>完整版本</strong></h2><p>Promise.js </p>
<h2 id="2-8-ES6-class-完整版"><a href="#2-8-ES6-class-完整版" class="headerlink" title="2.8. ES6 class 完整版"></a><strong>2.8. ES6 class</strong> <strong>完整版</strong></h2><h1 id="第-3-章：async与await"><a href="#第-3-章：async与await" class="headerlink" title="第 3 章：async与await"></a><strong>第</strong> <strong>3</strong> <strong>章：</strong>async与await</h1><h2 id="3-1-mdn-文档"><a href="#3-1-mdn-文档" class="headerlink" title="3.1. mdn 文档"></a><strong>3.1. mdn</strong> <strong>文档</strong></h2><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await</a></p>
<h2 id="3-2-async-函数"><a href="#3-2-async-函数" class="headerlink" title="3.2. async 函数"></a><strong>3.2. async</strong> <strong>函数</strong></h2><ol>
<li><p>函数的返回值为 promise 对象</p>
</li>
<li><p>promise 对象的结果由 async 函数执行的返回值决定</p>
</li>
</ol>
<h2 id="3-3-await-表达式"><a href="#3-3-await-表达式" class="headerlink" title="3.3. await 表达式"></a><strong>3.3. await</strong> <strong>表达式</strong></h2><ol>
<li><p>await 右侧的表达式一般为 promise 对象, 但也可以是其它的值</p>
</li>
<li><p>如果表达式是 promise 对象, await 返回的是 promise 成功的值</p>
</li>
<li><p>如果表达式是其它值, 直接将此值作为 await 的返回值</p>
</li>
</ol>
<h2 id="3-4-注意"><a href="#3-4-注意" class="headerlink" title="3.4. 注意"></a>3.4. <strong>注意</strong></h2><ol>
<li><p>await 必须写在 async 函数中, 但 async 函数中可以没有 await</p>
</li>
<li><p>如果 await 的 promise 失败了, 就会抛出异常, 需要通过 try…catch 捕获处理</p>
</li>
</ol>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-算法笔记之字符串篇"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/03/01/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%AF%87/"
    >算法笔记之字符串篇</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/03/01/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%AF%87/" class="article-date">
  <time datetime="2022-03-01T13:39:34.000Z" itemprop="datePublished">2022-03-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>整理在leetcode刷题过程中碰到的字符串涉及的算法知识</p> 
      <a class="article-more-link" href="/2022/03/01/%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%AF%87/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95-%E5%AD%97%E7%AC%A6%E4%B8%B2-leetcode/" rel="tag">算法 字符串 leetcode</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Ajax"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/03/01/Ajax/"
    >Ajax</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/03/01/Ajax/" class="article-date">
  <time datetime="2022-03-01T12:46:37.000Z" itemprop="datePublished">2022-03-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">web前端学习笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="什么是-AJAX-？"><a href="#什么是-AJAX-？" class="headerlink" title="什么是 AJAX ？"></a>什么是 AJAX ？</h2><p>AJAX = 异步 JavaScript 和 XML。</p>
<p>AJAX 是一种用于创建快速动态网页的技术。</p>
<p>通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>
<p>传统的网页（不使用 AJAX）如果需要更新内容，必需重载整个网页面。</p> 
      <a class="article-more-link" href="/2022/03/01/Ajax/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ajax-%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92/" rel="tag">ajax 前后端交互</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-git常用操作"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/03/01/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"
    >git常用操作</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/03/01/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2022-03-01T12:44:21.000Z" itemprop="datePublished">2022-03-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">web前端学习笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>本篇博客用于汇总git的常见操作以及相关知识</p> 
      <a class="article-more-link" href="/2022/03/01/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-CSS高级笔记"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/02/09/CSS%E9%AB%98%E7%BA%A7%E7%AC%94%E8%AE%B0/"
    >CSS高级技巧笔记</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/02/09/CSS%E9%AB%98%E7%BA%A7%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2021-02-09T09:12:59.000Z" itemprop="datePublished">2021-02-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">web前端学习笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="1-精灵图"><a href="#1-精灵图" class="headerlink" title="1.精灵图"></a>1.精灵图</h1><h2 id="精灵图-sprites-的使用"><a href="#精灵图-sprites-的使用" class="headerlink" title="精灵图( sprites )的使用"></a>精灵图( sprites )的使用</h2><p>使用精灵图核心:<br>1.精灵技术主要针对于背景图片使用。就是把多个小背景图片整合到-张大图片中。<br>2.这个大图片也称为sprites精灵图或者雪碧图<br>3.移动背景图片位置，此时可以使用background-position。<br>4.移动的距离就是这个目标图片的x和y坐标。注意网页中的坐标有所不同 
      <a class="article-more-link" href="/2021/02/09/CSS%E9%AB%98%E7%BA%A7%E7%AC%94%E8%AE%B0/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-CSS笔记"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/01/21/CSS%E7%AC%94%E8%AE%B0/"
    >CSS基础笔记</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/01/21/CSS%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2021-01-21T09:02:24.000Z" itemprop="datePublished">2021-01-21</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">web前端学习笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="CSS简介"><a href="#CSS简介" class="headerlink" title="CSS简介"></a>CSS简介</h1><p>CSS是层叠样式表( Cascading Style Sheets )的简称.<br>有时我们也会称之为CSS样式表或级联样式表。</p>
<p>CSS主要用于设置HTML页面中的文本内容(字体、大小、对齐方式等)、图片的外形(宽高、边框样式边距等)以及版面的布局和外观显示样式。</p>
<p>CSS也是一种标记语言</p>
<p>CSS最大价值:由HTML专注去做结构呈现,样式交给CSS,即结构(HTML)与样式( CSS )相分离。</p> 
      <a class="article-more-link" href="/2021/01/21/CSS%E7%AC%94%E8%AE%B0/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022
        <i class="ri-heart-fill heart_icon"></i> Jxx-sixhh
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Welcome to jxx&#39;s blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Web前端知识</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=1873321491&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>